/*!
 * Bootstrap-submenu v2.0.0 (http://vsn4ik.github.io/bootstrap-submenu)
 * Copyright 2015 Vasily A. (https://github.com/vsn4ik)
 * Licensed under the MIT license
 */

"use strict";!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){function b(b){this.$element=a(b),this.$menu=this.$element.closest(".dropdown-menu"),this.$main=this.$menu.parent(),this.$items=this.$menu.children(".dropdown-submenu"),this.init()}function c(b){this.$element=a(b),this.$main=this.$element.parent(),this.$menu=this.$main.children(".dropdown-menu"),this.$subs=this.$main.siblings(".dropdown-submenu"),this.$items=this.$menu.children(".dropdown-submenu"),this.init()}function d(b){this.$element=a(b),this.$main=this.$element.parent(),this.$menu=this.$main.children(".dropdown-menu"),this.$items=this.$menu.children(".dropdown-submenu"),this.init()}return b.prototype={init:function(){this.$element.on("keydown",a.proxy(this,"keydown"))},close:function(){this.$main.removeClass("open"),this.$items.trigger("hide.bs.submenu")},keydown:function(a){27==a.keyCode&&(a.stopPropagation(),this.close(),this.$main.children("a, button").trigger("focus"))}},a.extend(c.prototype,b.prototype,{init:function(){this.$element.on({click:a.proxy(this,"click"),keydown:a.proxy(this,"keydown")}),this.$main.on("hide.bs.submenu",a.proxy(this,"hide"))},click:function(a){a.stopPropagation(),this.toggle()},hide:function(a){a.stopPropagation(),this.close()},open:function(){this.$main.addClass("open"),this.$subs.trigger("hide.bs.submenu")},toggle:function(){this.$main.hasClass("open")?this.close():this.open()},keydown:function(b){32==b.keyCode&&b.preventDefault(),-1!=a.inArray(b.keyCode,[13,32])&&this.toggle()}}),d.prototype={init:function(){this.$menu.off("keydown.bs.dropdown.data-api"),this.$menu.on("keydown",a.proxy(this,"item_keydown")),this.$menu.find("li > a").each(function(){new b(this)}),this.$menu.find(".dropdown-submenu > a").each(function(){new c(this)}),this.$main.on("hidden.bs.dropdown",a.proxy(this,"hidden"))},hidden:function(){this.$items.trigger("hide.bs.submenu")},item_keydown:function(b){if(-1!=a.inArray(b.keyCode,[38,40])){b.preventDefault(),b.stopPropagation();var c=this.$menu.find("li:not(.disabled):visible > a"),d=c.index(b.target);if(38==b.keyCode&&0!==d)d--;else{if(40!=b.keyCode||d===c.length-1)return;d++}c.eq(d).trigger("focus")}}},a.fn.submenupicker=function(b){var c=this instanceof a?this:a(b);return c.each(function(){var b=a.data(this,"bs.submenu");b||(b=new d(this),a.data(this,"bs.submenu",b))})}});

// Initialize:
$(function() {
    $('[data-submenu]').submenupicker();

    var $navbarmain = $('.navbar-main');
    
    $('.dropdown-submenu > a').on('click', function() {

        // e.stopPropagation();

        var $this = $(this),
            $submenu = $this.parents('.dropdown-submenu').first(),
            $toggle = $this.parents('ul.dropdown-menu').first().siblings('a.dropdown-toggle').first();

        // // remove other .submenu-open
        // var $submenuopen = $navbarmain.find('.submenu-open');
        // // $submenuopen.removeClass('submenu-open');
        // // remove other .open
        // var $open = $navbarmain.find('.open');
        // $open.removeClass('open');
        // // remove other .open-ul 
        // var $openul = $navbarmain.find('.open-ul');
        // $openul.removeClass('open-ul');

        // trigger a click to hide other submenus:
        // $navbarmain.find('.open > a').trigger('click');
        // $this.trigger('click');

        // $submenu.addClass('submenu-open');


        
        // if ( $submenu.hasClass('open') ){
        //     $toggle.addClass('submenu-open');
        // } else {
        //     $toggle.removeClass('submenu-open');
        // }
    });

    $('.dropdown-toggle').on('click', function() {

        var $this = $(this),
            $submenu = $this.parents('.dropdown-submenu').first();

        $submenu.addClass('open');
        $submenu.siblings().removeClass('open');
        $submenu.siblings().each(function() {
            $(this).find('.dropdown-toggle').removeClass('submenu-open');
        });
        
        // hide others
        // $(this).addClass('submenu-open').parents('.dropdown-submenu').each(function() {
            // $(this).find('.dropdown-toggle').removeClass('.submenu-open');
        // });

        // $(this).parents('li').addClass('open');

    });

    $('.dropdown-submenu').on('hide.bs.submenu', function() {
        $(this).parents('ul.dropdown-menu').first().siblings('a.dropdown-toggle').first().removeClass('submenu-open');
    }).on('click', function(e) {
        e.stopPropagation();
    });

    $('.navbar-search-toggle').on('click', function(e) {
        e.preventDefault();
        $('#navbar-search').toggleClass('hidden-xs');
    });

    $('#navbar-search-input').on('focus blur', function() {
        $('.navbar-search-results').toggleClass('hidden');
    });


    $('a.dropdown-toggle').on('click', function() {
        $(this).parents('ul').first().toggleClass('open-ul');
    });

});